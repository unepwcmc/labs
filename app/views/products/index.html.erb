<div class="page-header">
  <!-- <h1>Our recent products</h1> -->
	<h1>We make excellent tools to explain and explore the value of the world's natural resources.</h1>
  <br>
	<h4>
		Some of our recent products are described below. If you would like to know more, please email
		<a href="mailto:ben.tregenna@unep-wcmc.org?subject=labs">Ben Tregenna</a>
	</h4>
</div>


<% if user_signed_in? %>
  <h2 class="products-list-header">
    <% if params[:user] %>
      My products
    <% else %>
      All products
    <% end %>
  </h2>
<% end %>

<div class="row">
  <div class="col-lg-6">

    <% if user_signed_in? %>
      <%= button_to "Add a new Product", new_product_path, method: :get, class: 'btn btn-primary' %>
      <% if params[:user] %>
        <%= button_to "All products", products_path, method: :get, class: 'btn btn-info' %>
      <% else %>
        <%= button_to "My products", products_path, params: {user: current_user }, method: :get, class: 'btn btn-info' %>
      <% end %>
    <% end %>
    &nbsp;
  </div>

  <div id="search-box" class="col-lg-6">
    <div class="form-group">
      <%= form_tag products_path, :method => "get", class: 'form-search form-inline' do %>
        <%= text_field_tag "search", params[:search], placeholder: "Search products...", class: "form-control" %>
        <%= submit_tag "Search", class: 'btn btn-primary' %>
      <% end %>
    </div>
  </div>
</div>

<div class="row">
  <% if params[:search].present? %>
    <div class="col-lg-12 col-lg-12 search-results-text">
      <h2>Showing <%= @products.length %> <%= "product".pluralize @products.length %> found matching "<%= params[:search] %>".</h2>
    </div>
  <% end %>
</div>

  <% unless @products.length == 0 %>
    <div class="row">
    <% @products.each_with_index do |product, i| %>
      <div class="col-lg-4 col-lg-4 product <%= product_style product %>">
        <%= link_to product_preview(product), product.url %>
        <p>
          <h2 class="heading--product"><%= link_to product.title, product.url %></h2>
          <p><%= product.description %></p>
          <% if user_signed_in? %>
            <%= link_to "Show", product_path(product) %> |
            <%= link_to "Edit", edit_product_path(product) %> |
            <%= link_to "Delete", product_path(product), method: :delete, data: { confirm: "Are you sure you want to delete this product?"} %>
          <% end %>
        </p>
      </div>
    <%# Start a new row every third product, except if it's the last one %>
      <% if (i==@products.length-1) %>
        </div>
      <% elsif (i!=0 && (i+1)%3==0) %>
        </div>
        <div class="row">
      <% end %>
    <% end %>
  <% end %>
